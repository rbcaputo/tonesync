<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:FreqGen.App.ViewModels"
             xmlns:models="clr-namespace:FreqGen.Presets.Models;assembly=FreqGen.Presets"
             x:Class="FreqGen.App.Views.MainPage"
             x:DataType="vm:MainViewModel"
             Title="FreqGen">

  <ScrollView>
    <VerticalStackLayout Padding="20" Spacing="20">

      <!-- Header -->
      <Label Text="FreqGen"
             FontSize="32"
             FontAttributes="Bold"
             HorizontalOptions="Center"
             Margin="0,20,0,0" />

      <Label Text="Frequency Therapy"
             FontSize="16"
             TextColor="{StaticResource Gray500}"
             HorizontalOptions="Center"
             Margin="0,0,0,20" />

      <!-- Loading Indicator -->
      <ActivityIndicator IsRunning="{Binding IsLoading}"
                         IsVisible="{Binding IsLoading}"
                         Color="{StaticResource Primary}"
                         HeightRequest="40"
                         Margin="0,10" />

      <!-- Error Display -->
      <Border BackgroundColor="{StaticResource Danger}"
              Padding="15"
              StrokeShape="RoundRectangle 10"
              IsVisible="{Binding HasError}">
        <VerticalStackLayout Spacing="10">
          <Label Text="⚠️ Error"
                 FontSize="16"
                 FontAttributes="Bold"
                 TextColor="White" />
          <Label Text="{Binding ErrorMessage}"
                 FontSize="14"
                 TextColor="White"
                 LineBreakMode="WordWrap" />
          <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
            <Button Text="Retry"
                    Command="{Binding RetryInitializationCommand}"
                    BackgroundColor="White"
                    TextColor="{StaticResource Danger}"
                    HeightRequest="40"
                    CornerRadius="8"
                    Padding="20,0" />
            <Button Text="Dismiss"
                    Command="{Binding DismissErrorCommand}"
                    BackgroundColor="Transparent"
                    TextColor="White"
                    BorderColor="White"
                    BorderWidth="1"
                    HeightRequest="40"
                    CornerRadius="8"
                    Padding="20,0" />
          </HorizontalStackLayout>
        </VerticalStackLayout>
      </Border>

      <!-- Status Display -->
      <Border BackgroundColor="{StaticResource Gray300}"
              Padding="20"
              StrokeShape="RoundRectangle 10">
        <Label Text="{Binding StatusText}"
               FontSize="14"
               HorizontalTextAlignment="Center"
               LineBreakMode="WordWrap" />
      </Border>

      <!-- Stop Button -->
      <Button Text="⏹ Stop"
              Command="{Binding StopCommand}"
              BackgroundColor="{StaticResource Primary}"
              TextColor="White"
              HeightRequest="50"
              CornerRadius="10"
              FontSize="16"
              FontAttributes="Bold"
              IsEnabled="{Binding IsPlaying}" />

      <!-- Preset Groups -->
      <VerticalStackLayout Spacing="10" IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}">
        <CollectionView ItemsSource="{Binding PresetGroups}"
                        SelectionMode="None">
          <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="vm:PresetGroup">
              <VerticalStackLayout Spacing="10" Margin="0,20,0,0">

                <!-- Category Header -->
                <Label Text="{Binding Name}"
                       FontSize="20"
                       FontAttributes="Bold"
                       Margin="0,0,0,10" />

                <!-- Presets in Category -->
                <VerticalStackLayout Spacing="10" BindableLayout.ItemsSource="{Binding .}">
                  <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="models:FrequencyPreset">
                      <Button Text="{Binding DisplayName}"
                              Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainViewModel}}, Path=PlayPresetCommand}"
                              CommandParameter="{Binding .}"
                              BackgroundColor="{StaticResource Gray800}"
                              TextColor="White"
                              HeightRequest="50"
                              CornerRadius="10"
                              Margin="0"
                              HorizontalOptions="Fill" />
                    </DataTemplate>
                  </BindableLayout.ItemTemplate>
                </VerticalStackLayout>

              </VerticalStackLayout>
            </DataTemplate>
          </CollectionView.ItemTemplate>
        </CollectionView>
      </VerticalStackLayout>

    </VerticalStackLayout>
  </ScrollView>

</ContentPage>
  